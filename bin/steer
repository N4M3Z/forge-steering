#!/usr/bin/env bash
# steer â€” list external steering content for a module.
# Reads the module's config.yaml for steering: paths and trees each directory.
# Called from SKILL.md !`command` blocks via DCI.
#
# Usage: steer <module_root>
set -euo pipefail

MODULE_ROOT="${1:?Usage: steer <module_root>}"
CONFIG="$MODULE_ROOT/config.yaml"
[ -f "$CONFIG" ] || CONFIG="$MODULE_ROOT/module.yaml"
[ -f "$CONFIG" ] || exit 0

while IFS= read -r line; do
  path=$(echo "$line" | sed 's/^[[:space:]]*-[[:space:]]*//' | sed 's/^["'"'"']//;s/["'"'"']$//')
  if [ -n "$path" ] && [ -f "$path" ]; then
    echo "$path"
  elif [ -n "$path" ] && [ -d "$path" ]; then
    tree "$path" 2>/dev/null
  fi
done < <(awk '/^steering:/{f=1;next} f && /^[[:space:]]*-/{print} f && /^[^ ]/{exit}' "$CONFIG")
